{
  "version": 3,
  "sources": ["../../@datadog/browser-rum/src/domain/replayStats.ts"],
  "sourcesContent": ["import type { ReplayStats } from '@datadog/browser-rum-core'\n\nexport const MAX_STATS_HISTORY = 1000\nlet statsPerView: Map<string, ReplayStats> | undefined\n\nexport function getSegmentsCount(viewId: string) {\n  return getOrCreateReplayStats(viewId).segments_count\n}\n\nexport function addSegment(viewId: string) {\n  getOrCreateReplayStats(viewId).segments_count += 1\n}\n\nexport function addRecord(viewId: string) {\n  getOrCreateReplayStats(viewId).records_count += 1\n}\n\nexport function addWroteData(viewId: string, additionalBytesCount: number) {\n  getOrCreateReplayStats(viewId).segments_total_raw_size += additionalBytesCount\n}\n\nexport function getReplayStats(viewId: string) {\n  return statsPerView?.get(viewId)\n}\n\nexport function resetReplayStats() {\n  statsPerView = undefined\n}\n\nfunction getOrCreateReplayStats(viewId: string) {\n  if (!statsPerView) {\n    statsPerView = new Map()\n  }\n\n  let replayStats: ReplayStats\n  if (statsPerView.has(viewId)) {\n    replayStats = statsPerView.get(viewId)!\n  } else {\n    replayStats = {\n      records_count: 0,\n      segments_count: 0,\n      segments_total_raw_size: 0,\n    }\n    statsPerView.set(viewId, replayStats)\n    if (statsPerView.size > MAX_STATS_HISTORY) {\n      deleteOldestStats()\n    }\n  }\n\n  return replayStats\n}\n\nfunction deleteOldestStats() {\n  if (!statsPerView) {\n    return\n  }\n  const toDelete = statsPerView.keys().next().value\n  if (toDelete) {\n    statsPerView.delete(toDelete)\n  }\n}\n"],
  "mappings": ";AAEO,IAAM,oBAAoB;AACjC,IAAI;AAEE,SAAU,iBAAiB,QAAc;AAC7C,SAAO,uBAAuB,MAAM,EAAE;AACxC;AAEM,SAAU,WAAW,QAAc;AACvC,yBAAuB,MAAM,EAAE,kBAAkB;AACnD;AAEM,SAAU,UAAU,QAAc;AACtC,yBAAuB,MAAM,EAAE,iBAAiB;AAClD;AAEM,SAAU,aAAa,QAAgB,sBAA4B;AACvE,yBAAuB,MAAM,EAAE,2BAA2B;AAC5D;AAEM,SAAU,eAAe,QAAc;AAC3C,SAAO,iBAAY,QAAZ,iBAAY,SAAA,SAAZ,aAAc,IAAI,MAAM;AACjC;AAMA,SAAS,uBAAuB,QAAc;AAC5C,MAAI,CAAC,cAAc;AACjB,mBAAe,oBAAI,IAAG;EACxB;AAEA,MAAI;AACJ,MAAI,aAAa,IAAI,MAAM,GAAG;AAC5B,kBAAc,aAAa,IAAI,MAAM;EACvC,OAAO;AACL,kBAAc;MACZ,eAAe;MACf,gBAAgB;MAChB,yBAAyB;;AAE3B,iBAAa,IAAI,QAAQ,WAAW;AACpC,QAAI,aAAa,OAAO,mBAAmB;AACzC,wBAAiB;IACnB;EACF;AAEA,SAAO;AACT;AAEA,SAAS,oBAAiB;AACxB,MAAI,CAAC,cAAc;AACjB;EACF;AACA,QAAM,WAAW,aAAa,KAAI,EAAG,KAAI,EAAG;AAC5C,MAAI,UAAU;AACZ,iBAAa,OAAO,QAAQ;EAC9B;AACF;",
  "names": []
}
