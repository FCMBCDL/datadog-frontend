{
  "version": 3,
  "sources": ["../../@datadog/browser-rum-react/src/domain/error/errorBoundary.ts", "../../@datadog/browser-rum-react/src/domain/reactPlugin.ts", "../../@datadog/browser-rum-react/src/domain/error/addReactError.ts", "../../@datadog/browser-rum-react/src/domain/performance/reactComponentTracker.tsx", "../../@datadog/browser-rum-react/src/domain/performance/timer.ts", "../../@datadog/browser-rum-react/src/domain/performance/addDurationVital.ts"],
  "sourcesContent": ["import React from 'react'\nimport type { ErrorInfo } from 'react'\nimport { addReactError } from './addReactError'\n\ninterface Props {\n  fallback: Fallback\n  children: React.ReactNode\n}\n\nexport type Fallback = React.ComponentType<{ error: Error; resetError: () => void }>\n\ntype State =\n  | {\n      didCatch: false\n      error: null\n    }\n  | {\n      didCatch: true\n      error: Error\n    }\n\nconst INITIAL_STATE: State = { didCatch: false, error: null }\n\n// eslint-disable-next-line no-restricted-syntax\nexport class ErrorBoundary extends React.Component<Props, State> {\n  constructor(props: Props) {\n    super(props)\n    this.state = INITIAL_STATE\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { didCatch: true, error }\n  }\n\n  resetError = () => {\n    this.setState(INITIAL_STATE)\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    addReactError(error, errorInfo)\n  }\n\n  render() {\n    if (this.state.didCatch) {\n      return React.createElement(this.props.fallback, {\n        error: this.state.error,\n        resetError: this.resetError,\n      })\n    }\n\n    return this.props.children\n  }\n}\n", "import type { RumPlugin, RumPublicApi, Strategy } from '@datadog/browser-rum-core'\n\nlet globalPublicApi: RumPublicApi | undefined\nlet globalConfiguration: ReactPluginConfiguration | undefined\nlet globalStrategy: Strategy | undefined\ntype InitSubscriber = (configuration: ReactPluginConfiguration, rumPublicApi: RumPublicApi) => void\ntype StartSubscriber = (strategy: Strategy) => void\n\nconst onRumInitSubscribers: InitSubscriber[] = []\nconst onRumStartSubscribers: StartSubscriber[] = []\n\nexport interface ReactPluginConfiguration {\n  /**\n   * Enable react-router integration\n   */\n  router?: boolean\n}\n\nexport function reactPlugin(configuration: ReactPluginConfiguration = {}) {\n  return {\n    name: 'react',\n    onInit({ publicApi, initConfiguration }) {\n      globalPublicApi = publicApi\n      globalConfiguration = configuration\n      for (const subscriber of onRumInitSubscribers) {\n        subscriber(globalConfiguration, globalPublicApi)\n      }\n      if (configuration.router) {\n        initConfiguration.trackViewsManually = true\n      }\n    },\n    onRumStart({ strategy }) {\n      globalStrategy = strategy\n      for (const subscriber of onRumStartSubscribers) {\n        subscriber(strategy)\n      }\n    },\n    getConfigurationTelemetry() {\n      return { router: !!configuration.router }\n    },\n  } satisfies RumPlugin\n}\n\nexport function onRumInit(callback: InitSubscriber) {\n  if (globalConfiguration && globalPublicApi) {\n    callback(globalConfiguration, globalPublicApi)\n  } else {\n    onRumInitSubscribers.push(callback)\n  }\n}\n\nexport function onRumStart(callback: StartSubscriber) {\n  if (globalStrategy) {\n    callback(globalStrategy)\n  } else {\n    onRumStartSubscribers.push(callback)\n  }\n}\n\nexport function resetReactPlugin() {\n  globalPublicApi = undefined\n  globalConfiguration = undefined\n  globalStrategy = undefined\n  onRumInitSubscribers.length = 0\n  onRumStartSubscribers.length = 0\n}\n", "import type { ErrorInfo } from 'react'\nimport { callMonitored, clocksNow, createHandlingStack } from '@datadog/browser-core'\nimport { onRumStart } from '../reactPlugin'\n\nexport function addReactError(error: Error, info: ErrorInfo) {\n  const handlingStack = createHandlingStack('react error')\n  const startClocks = clocksNow()\n  onRumStart((strategy) => {\n    callMonitored(() => {\n      strategy.addError({\n        error,\n        handlingStack,\n        componentStack: info.componentStack ?? undefined,\n        context: { framework: 'react' },\n        startClocks,\n      })\n    })\n  })\n}\n", "import * as React from 'react'\nimport { createTimer } from './timer'\nimport { addDurationVital } from './addDurationVital'\n\n// eslint-disable-next-line\nexport const UNSTABLE_ReactComponentTracker = ({\n  name: componentName,\n  children,\n}: {\n  name: string\n  children?: React.ReactNode\n}) => {\n  const isFirstRender = React.useRef(true)\n\n  const renderTimer = createTimer()\n  const effectTimer = createTimer()\n  const layoutEffectTimer = createTimer()\n\n  const onEffectEnd = () => {\n    const renderDuration = renderTimer.getDuration() ?? 0\n    const effectDuration = effectTimer.getDuration() ?? 0\n    const layoutEffectDuration = layoutEffectTimer.getDuration() ?? 0\n\n    const totalRenderTime = renderDuration + effectDuration + layoutEffectDuration\n\n    addDurationVital('reactComponentRender', {\n      description: componentName,\n      startTime: renderTimer.getStartTime()!, // note: renderTimer should have been started at this point, so getStartTime should not return undefined\n      duration: totalRenderTime,\n      context: {\n        is_first_render: isFirstRender.current,\n        render_phase_duration: renderDuration,\n        effect_phase_duration: effectDuration,\n        layout_effect_phase_duration: layoutEffectDuration,\n        framework: 'react',\n      },\n    })\n\n    isFirstRender.current = false\n  }\n\n  // In react, children are rendered sequentially in the order they are defined. that's why we can\n  // measure perf timings of a component by starting recordings in the component above and stopping\n  // them in the component below.\n  return (\n    <>\n      <LifeCycle\n        onRender={renderTimer.startTimer}\n        onLayoutEffect={layoutEffectTimer.startTimer}\n        onEffect={effectTimer.startTimer}\n      />\n      {children}\n      <LifeCycle\n        onRender={renderTimer.stopTimer}\n        onLayoutEffect={layoutEffectTimer.stopTimer}\n        onEffect={() => {\n          effectTimer.stopTimer()\n          onEffectEnd()\n        }}\n      />\n    </>\n  )\n}\n\nfunction LifeCycle({\n  onRender,\n  onLayoutEffect,\n  onEffect,\n}: {\n  onRender: () => void\n  onLayoutEffect: () => void\n  onEffect: () => void\n}) {\n  onRender()\n  React.useLayoutEffect(onLayoutEffect)\n  React.useEffect(onEffect)\n  return null\n}\n", "import type { Duration, RelativeTime, TimeStamp } from '@datadog/browser-core'\nimport { elapsed, relativeNow, timeStampNow } from '@datadog/browser-core'\n\nexport function createTimer() {\n  let duration: Duration | undefined\n  let startTime: TimeStamp | undefined\n  let highPrecisionStartTime: RelativeTime | undefined\n\n  return {\n    startTimer(this: void) {\n      // timeStampNow uses Date.now() internally, which is not high precision, but this is what is\n      // used for other events, so we use it here as well.\n      startTime = timeStampNow()\n\n      // relativeNow uses performance.now() which is higher precision than Date.now(), so we use for\n      // the duration\n      highPrecisionStartTime = relativeNow()\n    },\n\n    stopTimer(this: void) {\n      duration = elapsed(highPrecisionStartTime!, relativeNow())\n    },\n\n    getDuration(this: void) {\n      return duration\n    },\n\n    getStartTime(this: void) {\n      return startTime\n    },\n  }\n}\n", "import type { RumPublicApi } from '@datadog/browser-rum-core'\nimport { onRumInit } from '../reactPlugin'\n\nexport const addDurationVital: RumPublicApi['addDurationVital'] = (name, options) => {\n  onRumInit((_, rumPublicApi) => {\n    rumPublicApi.addDurationVital(name, options)\n  })\n}\n"],
  "mappings": "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",
  "names": ["React", "React"]
}
